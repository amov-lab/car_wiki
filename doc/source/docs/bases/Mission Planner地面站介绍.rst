Mission Planner地面站介绍
=========================

.. tip::

    `Mission Planner下载地址 <https://ardupilot.org/planner/docs/mission-planner-installation.html>`_

Mission Planner介绍
------------------------

Mission Planner是一款Windows系统下的软件，简称MP地面站，主要功能是连接上飞控，与飞控之间进行通信，
能够实时显示飞控相关数据和对飞控进行控制。

.. image:: ../../images/bases/MP.png

如图所示，图片内容为MP地面站的界面

.. image:: ../../images/bases/MP-interface.png

此处为界面显示内容的选项，不同的选项界面会显示相应的内容

**飞行数据：**
飞行数据界面内容主要展示无人车飞控相关数据包含GPS数据状态，EKF定位状态，无人车当前模式，解上锁状况，无人车相关数据，地图等

**飞行计划：**
在该界面可画出无人车的航点，将航点传入到飞控中，修改航点相关的参数，读取飞控的航点等内容。

**初始设置：**
传感器校准就需要在此界面设置，一般来说，需要校准的传感器为罗盘，加速度计，平面校准等。

.. note::

    无人车相比于无人机对传感器要求较低，一般情况下无需校准。

    某些版本地面站在传感器校准时会发生异常，出现该情况时，请更换地面站版本进行传感器校准。

**配置/调试：**
查看以及修改飞控的参数。

.. warning::

    参数修改需充分了解APM以及Mission Planner相关基础知识，需谨慎使用，修改错误将导致无人车无法正常运行。

---------

模拟以及帮助选项与无人车使用相关，此处不再介绍，如需了解或使用，请自行学习相关知识。

传感器校准
-------------

|    在使用过程中偶尔会出现传感器异常的问题，这个时候就需要进行校准，传感器校准分为以下几个内容：一是遥控输入校准,二是加速度校准，三是罗盘校准，如果这三件事不做，后续的解锁是不能进行的，MP的姿态界面上也会不断弹出红色提示：PreArm： RC not calibrated（解锁准备：遥控器没有校准）。

|    将GPS的输出接上飞控的对应的GPS MODULE口，打开地面站，USB连接飞控，选择“连接”，连
|    接成功后进入“初始设置”页面，展开左侧“必要硬件”，准备校准。

.. attention:: 设置COM端口号和波特率，选择计算机新增的端口号，波特率选择115200

加速度计校准
-----------------------------
|          点击左侧列表“加速度计校准”进入校准界面，按提示放置飞控，首先校准水平，每一步完成后
|       点击绿色“Click When Done”按钮，如果安装最新地面站后界面为中文，按提示完成校准操作即可。

.. image:: ../../images/bases/calibration_accel_1.png

随后校准加速度计，提示如下：

    第一个：Place vehicle level and press any key: （请把无人车水平放置然后按任意键继续）

    第二个：Place vehicle on its LEFT side and press any key: （请把无人车右边向上垂直立起）

    第三个：Place vehicle on its RIGHT side and press any key:（请把无人车左边向上垂直立起）

    第四个：Place vehicle nose DOWN and press any key: （请把无人车机头向下垂直立起）

    第五个：Place vehicle nose UP and press any key: （请把无人车机头向上垂直立起）

    第六个：Place APM on its BACK and press any key（请把无人车底部向上水平放置）

如图校准成功后提示success：

.. image:: ../../images/bases/calibration_accel_2.png

指南针校准
-----------------------------

**校准步骤如下：**

    1.连接飞控

    2.初始设置-必要硬件-罗盘

    3.只勾选第一个，（如需提高精度也可添加外置罗盘）准备好后点击开始现场校准

    .. image:: ../../images/bases/calibration_compass_1.png

    4.进行校准

    方法：每个面绕其中心轴旋转360度，校准过程中注意千万不要碰到USB线，以免断开飞控。

    5.校准完后，界面会有新的三轴的值，绿色值表示正常。

    .. image:: ../../images/bases/calibration_compass_1.png

    6.注意事项

    （1）在室内会做校正罗盘时候，室内设备会对地磁产生干扰影响罗盘精度，如需提高精度建议在室外做一次。

    （2）APM内置的罗盘很容易受到飞控内电子元件干扰，还有电池、接收机等其它的干扰，如果用外置的罗盘的话精度会增加不少。

    （3）在飞行器重新布线、升级固件、添加或者换设备时候，建议重新做一次校正罗盘。

|          如果你刷了1.3.5以上版本的固件，还加了外置罗盘，可能会遇到一个问题：就是外置罗盘一直
|       没法校准，进度条一直在动，没有提示校准成功。那这个问题在哪里呢?

|          没校准之前，GPS所在的磁场环境可能和飞控内置罗盘磁场有所不同导致存在偏差。导致校准
|       GPS罗盘没有正确触碰到白点，而恰恰最新版的地面站去掉了显示白点的界面，有时候校准存在一些不方便!

.. tip:: 最新版本的固件对罗盘校准要求越来越高。如果你刷了最新版本固件，还用了最新地面站，如果你校准时，飞控和GPS没有固定一起，或者飞控和GPS的箭头不一致，基本上校准不通过。所以，新版本固件校准时，一定要确保飞控和GPS箭头一致，校准移动时，要同步同时移动飞控和GPS，不可以单独。

**解决方法：**  

    1.刷了最新版本固件，要用最新的地面站，否则可能校准过程会卡在99%就不动了。

    2.GPS要固定好，GPS用支架撑起来，飞控的箭头和GPS的箭头保持（这点非常重要，否则基本通不过)。校准时，飞控和GPS一起同步移动（不同步移动，基本校准不过)。
    
    .. hint:: 如果GPS固定好，箭头和飞控箭头一致，安装到机架上，很容易通过校准。箭头一致后，用手固定好GPS和飞控，移动时，GPS和飞控同步同时移动。

    3.地面站的Fitness改为Relaxed 或者default，重新校准罗盘，就很容易校准。

.. image:: ../../images/bases/calibration_compass_3.png
    :alt: None
    :align: center

遥控器校准
-----------------------------

**1.开始遥控器校准（以美国手为例）**

将遥控器通道按钮都拨至最上方，同时按下遥控器两边的开机按钮。

（1）连接地面站（飞控自检完成后）

（2）点击初始设置-可选硬件-遥控器校准

（3）打开遥控器，确认已接上接收机。

（4）来回拨动遥控器的开关，使每个档位分别到达其最大和最小，MP遥控通道上红色线条的显示，让地面站记录其最大行程和最小行程。

.. attention:: 这里要保证油门上推，代表油门的绿色条也向上，roll和Yaw也是，pitch相反，如果不是，可在遥控器的舵机相位中修改正反相

（5）点击完成，会出现各通道值。

（6）观测遥控器行程，最小值小于1100，最大值大于1900，则遥控器正常

.. image:: ../../images/bases/calibration_FS_1.png

.. attention:: 遥控器左右摇杆控制4个柱面（正确的方向在图下文字中做出了说明）只有升降舵为反向。

正向：表示上下左右和摇杆操作一致，例如，向左打杆，输出变小，向上打杆，输出变大
反向：表示上下左右和摇杆操作相反，例如，向左打杆，输出变大，向上打杆，输出变小。

油门推到顶/油门降到底（正向为正确（如果油门推上去输出反而下降，则需要在遥控器设置中将油门反向））

.. image:: ../../images/bases/calibration_FS_2.png
    :height: 850px
    :width: 400px
    :scale: 30 %
    :alt: None
    :align: center

|       左摇杆打到最左/左摇杆打到最右（方向、航向、偏航：机头指向，正向为正确）,右摇杆打到最
|       左侧/右摇杆打到最右侧（副翼-横滚，正向为正确）

.. image:: ../../images/bases/calibration_FS_3.png
    :height: 850px
    :width: 1100px
    :scale: 30 %
    :alt: None
    :align: center

右摇杆推到顶/右摇杆打到底（升降：右摇杆上下， 反向为正确）

.. image:: ../../images/bases/calibration_FS_4.png
    :height: 850px
    :width: 400px
    :scale: 30 %
    :alt: None
    :align: center

所有摇杆均在1094-1934之间变化，满足要求。

|          点击“校准”，将遥控器左右摇杆重复打到最值，即左右摇杆在最大值上不停转圈，得到校准数据
|       如下：

.. image:: ../../images/bases/calibration_FS_5.png
    :height: 850px
    :width: 1100px
    :scale: 30 %
    :alt: None
    :align: center

|          操作完成后点击“完成时点击”按钮，弹出完成提示对话框点击“OK”后将弹出校准数据，说明指
|       南针校准成功：

.. image:: ../../images/bases/calibration_FS_6.png
    :alt: None
    :align: center





